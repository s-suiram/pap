#!/usr/bin/env bash

# rm -f ./plots/data/perf_data.csv
# rm -f plot_previous.pdf
# mv plot.pdf plot_previous.pdf
# rm -f plot.pdf

# sizes6208=(16 17 32 34 64 68 128 136 272 544)

# for h in ${sizes6208[@]}; do
#     for w in ${sizes6208[@]}; do
#         for nbThread in $(seq 8 16); do 
#             OMP_NUM_THREADS=$nbThread ./run -k life -v tiled_omp -tw $w -th $h -s 2176 -a otca_off -n -i 20;
#         done
#     done
# done

# ./plots/easyplot.py


###
# Script to compare each frame of two different variant of the same kernel
###

i=1000
s=6208
lazy=tiled_omp_lazy
tiled=tiled

using=$lazy

try=2

make

for t in $(seq 0 $try); do
    rm dump-life-seq-dim-*-iter-*.png;
    rm dump-life-$using-dim-*-iter-*.png;

    ./run -k life -v seq -s $s -a meta3x3 -n -i $i --dump 2> /dev/null;
    OMP_PLACES=cores ./run -k life -v $using -a meta3x3 -ts 64 -s $s -n -i $i --dump 2> /dev/null;

    res=$(diff -s dump-life-seq-dim-$s-iter-$i.png dump-life-$using-dim-$s-iter-$i.png | cut -d " " -f 6);
    echo $res
    if [ "$res" = "differ" ]; then
        break;
    fi
done

echo "done"