#!/usr/bin/env bash

VERSIONS=(
  "seq"
  "vec_seq"
  "vec_tiled"
  "vec_omp_tiled_lazy"
)

tileWidths=(32 64 128)
tileHeights=(16 32 64 128)
size=1024
iter=700
i=3

############## vec_tiled

rm -f plots/data/perf_data.csv

for i in $(seq 1 $i); do
  for w in ${tileWidths[*]}; do
    for h in ${tileHeights[*]}; do
      ./run -k life_vec -v vec_tiled -tw $w -th $h -s $size -n -i $iter -a random
    done
  done
done

plots/easyplot.py -y time
mv plot.pdf vec_tiled.pdf

############## Lazy tiled vec omp

rm -f plots/data/perf_data.csv

threads=(1 5 12 16)
#threads=(1 10 20 30 40 46)

for i in $(seq 1 $i); do
  for nbThread in ${threads[*]}; do
    for w in ${tileWidths[*]}; do
      for h in ${tileHeights[*]}; do
        OMP_PLACES=cores OMP_NUM_THREADS=$nbThread ./run -k life_vec -v vec_omp_tiled_lazy -tw $w -th $h -s $size -n -i $iter -ft -a random
      done
    done
  done
done

plots/easyplot.py -y time
mv plot.pdf omp_vec_tiled_lazy.pdf
